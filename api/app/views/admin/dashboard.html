<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Back-office - Administration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/dist/css/main.css">
</head>
<body class="dashboard">
    <?php require __DIR__ . '/../components/sidebar.html'; ?>

    <div class="dashboard__container">
        <div class="dashboard__header">
            <h1 class="dashboard__title">Tableau de Bord</h1>
            <a href="/admin/articles/create" class="button button--indigo">
                <svg width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M15 8H17M15 12H17M17 16H7M7 8V12H11V8H7ZM5 20H19C20.1046 20 21 19.1046 21 18V6C21 4.89543 20.1046 4 19 4H5C3.89543 4 3 4.89543 3 6V18C3 19.1046 3.89543 20 5 20Z" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></g></svg>                        
                Nouvel article</a>
        </div>
        <div class="dashboard__welcome">
            Bienvenue, <?= htmlspecialchars($current_user->firstname ?? 'Utilisateur') ?> !
        </div>
        <!-- <div class="dashboard__logout">
            <form method="POST" action="/api/v1/auth/logout">
                <input type="hidden" name="csrf_token" value="<?= isset($csrf_token) ? htmlspecialchars($csrf_token) : '' ?>">
                <button type="submit" class="button button--danger">
                    Se d√©connecter
                </button>
            </form>
        </div> -->
        <div class="stats-grid">
            <div class="stats-row">
                <div class="stats-card">
                    <div class="stats-card__icon stats-card__icon--yellow">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M15 8H17M15 12H17M17 16H7M7 8V12H11V8H7ZM5 20H19C20.1046 20 21 19.1046 21 18V6C21 4.89543 20.1046 4 19 4H5C3.89543 4 3 4.89543 3 6V18C3 19.1046 3.89543 20 5 20Z" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></g></svg>                        
                    </div>
                    <div class="stats-card__content">
                        <h3 class="stats-card__label">Articles</h3>
                        <p class="stats-card__value"><?= $stats['articles']['total'] ?? 0 ?></p>
                    </div>
                </div>
                <div class="stats-card__details">
                    <span>Publi√©s: <?= $stats['articles']['published'] ?? 0 ?></span>
                    <span>Brouillons: <?= $stats['articles']['drafts'] ?? 0 ?></span>
                    <span>Archiv√©s: <?= $stats['articles']['archived'] ?? 0 ?></span>
                </div>
            </div>
            <?php if (isset($is_admin) && $is_admin && isset($stats['users'])): ?>
            <div class="stats-row">
                <div class="stats-card">
                    <div class="stats-card__icon stats-card__icon--green">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M3 19H1V18C1 16.1362 2.27477 14.57 4 14.126M6 10.8293C4.83481 10.4175 4 9.30623 4 8.00001C4 6.69379 4.83481 5.58255 6 5.17072M21 19H23V18C23 16.1362 21.7252 14.57 20 14.126M18 5.17072C19.1652 5.58255 20 6.69379 20 8.00001C20 9.30623 19.1652 10.4175 18 10.8293M10 14H14C16.2091 14 18 15.7909 18 18V19H6V18C6 15.7909 7.79086 14 10 14ZM15 8C15 9.65685 13.6569 11 12 11C10.3431 11 9 9.65685 9 8C9 6.34315 10.3431 5 12 5C13.6569 5 15 6.34315 15 8Z" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    </div>
                    <div class="stats-card__content">
                        <h3 class="stats-card__label">Utilisateurs</h3>
                        <p class="stats-card__value"><?= $stats['users']['total'] ?? 0 ?></p>
                    </div>
                </div>
                <div class="stats-card__details">
                    <span>Admins: <?= $stats['users']['admins'] ?? 0 ?></span>
                    <span>√âditeurs: <?= $stats['users']['editors'] ?? 0 ?></span>
                    <span>Auteurs: <?= $stats['users']['authors'] ?? 0 ?></span>
                </div>
            </div>    
            <?php endif; ?>

            <?php if (isset($can_manage_categories) && $can_manage_categories && isset($stats['categories'])): ?>            
            <div class="stats-row">
                <div class="stats-card">
                    <div class="stats-card__icon stats-card__icon--purple">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M17 10H19C21 10 22 9 22 7V5C22 3 21 2 19 2H17C15 2 14 3 14 5V7C14 9 15 10 17 10Z" stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M5 22H7C9 22 10 21 10 19V17C10 15 9 14 7 14H5C3 14 2 15 2 17V19C2 21 3 22 5 22Z" stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M6 10C8.20914 10 10 8.20914 10 6C10 3.79086 8.20914 2 6 2C3.79086 2 2 3.79086 2 6C2 8.20914 3.79086 10 6 10Z" stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M18 22C20.2091 22 22 20.2091 22 18C22 15.7909 20.2091 14 18 14C15.7909 14 14 15.7909 14 18C14 20.2091 15.7909 22 18 22Z" stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    </div>
                    <div class="stats-card__content">
                        <h3 class="stats-card__label">Cat√©gories</h3>
                        <p class="stats-card__value"><?= $stats['categories'] ?? 0 ?></p>
                    </div>
                </div>
                <div class="stats-card__details">
                    <a href="/admin/categories" class="stats-card__link">Voir toutes
                        <svg fill="#000000" width="12px" height="12px" viewBox="0 0 24 24" id="right-arrow" data-name="Flat Color" xmlns="http://www.w3.org/2000/svg" class="icon flat-color"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path id="primary" d="M21.71,11.29l-3-3a1,1,0,0,0-1.42,1.42L18.59,11H3a1,1,0,0,0,0,2H18.59l-1.3,1.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l3-3A1,1,0,0,0,21.71,11.29Z" style="fill: #999;"></path></g></svg>
                    </a>
                </div>
            </div>    
            <?php endif; ?>

            <?php if (isset($can_manage_categories) && $can_manage_categories && isset($stats['tags'])): ?>            
            <div class="stats-row">
                <div class="stats-card">
                    <div class="stats-card__icon stats-card__icon--pink">
                        <svg fill="#fafafa" width="26px" height="26px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" stroke="#fafafa"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <rect id="Icons" x="-384" y="-320" width="1280" height="800" style="fill:none;"></rect> <g id="Icons1" serif:id="Icons"> <g id="Strike"> </g> <g id="H1"> </g> <g id="H2"> </g> <g id="H3"> </g> <g id="list-ul"> </g> <g id="hamburger-1"> </g> <g id="hamburger-2"> </g> <g id="list-ol"> </g> <g id="list-task"> </g> <g id="trash"> </g> <g id="vertical-menu"> </g> <g id="horizontal-menu"> </g> <g id="sidebar-2"> </g> <g id="Pen"> </g> <g id="Pen1" serif:id="Pen"> </g> <g id="clock"> </g> <g id="external-link"> </g> <g id="hr"> </g> <g id="info"> </g> <g id="warning"> </g> <g id="plus-circle"> </g> <g id="minus-circle"> </g> <g id="vue"> </g> <g id="cog"> </g> <g id="logo"> </g> <g id="radio-check"> </g> <g id="eye-slash"> </g> <g id="eye"> </g> <g id="toggle-off"> </g> <g id="shredder"> </g> <g> <path d="M9.89,30.496c-1.14,1.122 -1.784,2.653 -1.791,4.252c-0.006,1.599 0.627,3.135 1.758,4.266c3.028,3.028 7.071,7.071 10.081,10.082c2.327,2.326 6.093,2.349 8.448,0.051c5.91,-5.768 16.235,-15.846 19.334,-18.871c0.578,-0.564 0.905,-1.338 0.905,-2.146c0,-4.228 0,-17.607 0,-17.607l-17.22,0c-0.788,0 -1.544,0.309 -2.105,0.862c-3.065,3.018 -13.447,13.239 -19.41,19.111Zm34.735,-15.973l0,11.945c0,0.811 -0.329,1.587 -0.91,2.152c-3.069,2.981 -13.093,12.718 -17.485,16.984c-1.161,1.127 -3.012,1.114 -4.157,-0.031c-2.387,-2.386 -6.296,-6.296 -8.709,-8.709c-0.562,-0.562 -0.876,-1.325 -0.872,-2.12c0.003,-0.795 0.324,-1.555 0.892,-2.112c4.455,-4.373 14.545,-14.278 17.573,-17.25c0.561,-0.551 1.316,-0.859 2.102,-0.859c3.202,0 11.566,0 11.566,0Zm-7.907,2.462c-1.751,0.015 -3.45,1.017 -4.266,2.553c-0.708,1.331 -0.75,2.987 -0.118,4.356c0.836,1.812 2.851,3.021 4.882,2.809c2.042,-0.212 3.899,-1.835 4.304,-3.896c0.296,-1.503 -0.162,-3.136 -1.213,-4.251c-0.899,-0.953 -2.18,-1.548 -3.495,-1.57c-0.031,-0.001 -0.062,-0.001 -0.094,-0.001Zm0.008,2.519c1.105,0.007 2.142,0.849 2.343,1.961c0.069,0.384 0.043,0.786 -0.09,1.154c-0.393,1.079 -1.62,1.811 -2.764,1.536c-1.139,-0.274 -1.997,-1.489 -1.802,-2.67c0.177,-1.069 1.146,-1.963 2.27,-1.981c0.014,0 0.029,0 0.043,0Z"></path> <path d="M48.625,13.137l0,4.001l3.362,0l0,11.945c0,0.811 -0.328,1.587 -0.909,2.152c-3.069,2.981 -13.093,12.717 -17.485,16.983c-1.161,1.128 -3.013,1.114 -4.157,-0.03l-0.034,-0.034l-1.016,0.993c-0.663,0.646 -1.437,1.109 -2.259,1.389l1.174,1.174c2.327,2.327 6.093,2.35 8.447,0.051c5.91,-5.768 16.235,-15.845 19.335,-18.87c0.578,-0.565 0.904,-1.339 0.904,-2.147c0,-4.227 0,-17.607 0,-17.607l-7.362,0Z"></path> </g> <g id="spinner--loading--dots-" serif:id="spinner [loading, dots]"> </g> <g id="react"> </g> <g id="check-selected"> </g> <g id="turn-off"> </g> <g id="code-block"> </g> <g id="user"> </g> <g id="coffee-bean"> </g> <g id="coffee-beans"> <g id="coffee-bean1" serif:id="coffee-bean"> </g> </g> <g id="coffee-bean-filled"> </g> <g id="coffee-beans-filled"> <g id="coffee-bean2" serif:id="coffee-bean"> </g> </g> <g id="clipboard"> </g> <g id="clipboard-paste"> </g> <g id="clipboard-copy"> </g> <g id="Layer1"> </g> </g> </g></svg>
                    </div>
                    <div class="stats-card__content">
                        <h3 class="stats-card__label">Tags</h3>
                        <p class="stats-card__value"><?= $stats['tags'] ?? 0 ?></p>
                    </div>
                </div>
                <div class="stats-card__details">
                    <a href="/admin/tags" class="stats-card__link">Voir tous
                        <svg fill="#000000" width="12px" height="12px" viewBox="0 0 24 24" id="right-arrow" data-name="Flat Color" xmlns="http://www.w3.org/2000/svg" class="icon flat-color"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path id="primary" d="M21.71,11.29l-3-3a1,1,0,0,0-1.42,1.42L18.59,11H3a1,1,0,0,0,0,2H18.59l-1.3,1.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l3-3A1,1,0,0,0,21.71,11.29Z" style="fill: #999;"></path></g></svg>
                    </a>
                </div>
            </div>    
            <?php endif; ?>

            <?php if (empty($is_admin) && isset($stats['media'])): ?>
            <div class="stats-row">
                <div class="stats-card">
                    <div class="stats-card__icon stats-card__icon--orange">
                        <svg width="24px" height="24px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4 16L8.586 11.414C8.96112 11.0391 9.46967 10.8284 10 10.8284C10.5303 10.8284 11.0389 11.0391 11.414 11.414L16 16M14 14L15.586 12.414C15.9611 12.0391 16.4697 11.8284 17 11.8284C17.5303 11.8284 18.0389 12.0391 18.414 12.414L20 14M14 8H14.01M6 20H18C19.1046 20 20 19.1046 20 18V6C20 4.89543 19.1046 4 18 4H6C4.89543 4 4 4.89543 4 6V18C4 19.1046 4.89543 20 6 20Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    </div>
                    <div class="stats-card__content">
                        <h3 class="stats-card__label">M√©dias</h3>
                        <p class="stats-card__value"><?= $stats['media']['total'] ?? 0 ?></p>
                    </div>
                </div>
                <div class="stats-card__details">
                    <a href="/admin/medias" class="stats-card__link">Voir la m√©diath√®que
                        <svg width="12px" height="12px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4 16L8.586 11.414C8.96112 11.0391 9.46967 10.8284 10 10.8284C10.5303 10.8284 11.0389 11.0391 11.414 11.414L16 16M14 14L15.586 12.414C15.9611 12.0391 16.4697 11.8284 17 11.8284C17.5303 11.8284 18.0389 12.0391 18.414 12.414L20 14M14 8H14.01M6 20H18C19.1046 20 20 19.1046 20 18V6C20 4.89543 19.1046 4 18 4H6C4.89543 4 4 4.89543 4 6V18C4 19.1046 4.89543 20 6 20Z" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    </a>
                </div>
            </div>    
            <?php endif; ?>
        </div>
        <div class="dashboard__grid">
            <!-- Colonne gauche : Articles r√©cents -->
            <div class="dashboard__widget">
                <div class="widget">
                    <div class="widget__header">
                        <h2 class="widget__title">Articles r√©cents</h2>
                        <a href="/admin/articles" class="widget__link">Voir tout</a>
                    </div>
                    <div class="widget__content">
                        <?php if (empty($recent_articles)): ?>
                            <p class="widget__empty">Aucun article pour le moment.</p>
                        <?php else: ?>
                            <ul class="article-list">
                                <?php foreach ($recent_articles as $article): ?>
                                <li class="article-list__item">
                                    <div class="article-list__info">
                                        <h3 class="article-list__title">
                                            <a href="/admin/articles/edit/<?= $article['id'] ?>">
                                                <?= htmlspecialchars($article['title']) ?>
                                            </a>
                                        </h3>
                                        <div class="article-list__meta">
                                            <span class="badge badge--<?= $article['status'] === 'published' ? 'success' : ($article['status'] === 'draft' ? 'warning' : 'secondary') ?>">
                                                 <?php if ($article['status'] === 'published') echo 'Publi√©'; ?>
                                                 <?php if ($article['status'] === 'draft') echo 'Brouillon'; ?>
                                                 <?php if ($article['status'] === 'archived') echo 'Archiv√©'; ?>
                                            </span>
                                            <i class="article-list__author">
                                                Par <?= htmlspecialchars($article['author_name']) ?> <span class="article-list__date">
                                                le <?= date('d/m/Y', strtotime($article['created_at'])) ?></span>
                                            </i>
                                            
                                        </div>
                                    </div>
                                </li>
                                <?php endforeach; ?>
                            </ul>
                        <?php endif; ?>
                    </div>
                </div>
            </div>

            <!-- Colonne droite : Actions rapides -->
            <div class="dashboard__widget">
                <div class="widget">
                    <div class="widget__header">
                        <h2 class="widget__title">Actions rapides</h2>
                    </div>
                    <div class="widget__content">
                        <div class="quick-actions">
                            <a href="/admin/articles/create" class="quick-action">
                                <span class="quick-action__icon">‚úèÔ∏è</span>
                                <span class="quick-action__label">Cr√©er un article</span>
                            </a>
                            <a href="/admin/media/upload" class="quick-action">
                                <span class="quick-action__icon">üì§</span>
                                <span class="quick-action__label">Uploader un m√©dia</span>
                            </a>
                            <?php if (isset($can_manage_categories) && $can_manage_categories): ?>
                            <a href="/admin/categories/create" class="quick-action">
                                <span class="quick-action__icon">üìÇ</span>
                                <span class="quick-action__label">Nouvelle cat√©gorie</span>
                            </a>
                            <a href="/admin/tags/create" class="quick-action">
                                <span class="quick-action__icon">üè∑Ô∏è</span>
                                <span class="quick-action__label">Nouveau tag</span>
                            </a>
                            <?php endif; ?>
                            <?php if (isset($is_admin) && $is_admin): ?>
                            <a href="/admin/users/create" class="quick-action">
                                <span class="quick-action__icon">üë§</span>
                                <span class="quick-action__label">Nouvel utilisateur</span>
                            </a>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
